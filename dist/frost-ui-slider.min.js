!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@fr0st/ui"),require("@fr0st/query")):"function"==typeof define&&define.amd?define(["exports","@fr0st/ui","@fr0st/query"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).UI=t.UI||{},t.UI,t.fQuery)}(this,(function(t,e,i){"use strict";class s extends e.BaseComponent{constructor(t,e){super(t,e),this._render();let s=i.getValue(this._node);if(this._options.range){this._eventsRange();const t=i._isArray(s)?s:`${s}`.split(this._options.rangeSeparator,2);let e,o;2===t.length?(e=t[0],o=t[1]):(e=this._options.defaultValue,o=this._options.defaultValue),this._setValueRange(e,o)}else this._events(),""===s&&(s=this._options.defaultValue),this._setValue(s);"show"===this._options.tooltip&&this._eventsTooltip(),this._refreshDisabled()}disable(){i.setAttribute(this._node,{disabled:!0}),this._refreshDisabled()}dispose(){this._tooltip&&(this._tooltip.dispose(),this._tooltip=null),i.remove(this._container),i.removeEvent(this._node,"focus.ui.slider"),i.removeClass(this._node,this.constructor.classes.hide),i.removeAttribute(this._node,"tabindex"),this._container=null,this._slider=null,this._barLow=null,this._barSelection=null,this._barHigh=null,this._handleEnd=null,this._handleStart=null,this._handleActive=null,this._tickContainer=null,this._ticks=null,super.dispose()}enable(){i.removeAttribute(this._node,"disabled"),this._refreshDisabled()}getValue(){return this._options.range?[this._startValue,this._endValue]:this._value}setValue(t,e){this._options.range?this._setValueRange(t,e):this._setValue(t)}}s.defaults={min:0,max:10,defaultValue:0,orientation:"horizontal",scale:"linear",valueText:t=>t,rangeText:(t,e)=>`${t} - ${e}`,tickSize:30,handleSize:20,handleSizeRatio:.75,sliderSize:10,verticalHeight:200,step:1,tooltip:"show",tooltipPlacement:null,low:null,selection:"bg-primary",high:null,ticks:[],tickLabels:[],tickSnapBounds:0,lockToTicks:!1,rangeHighlights:[],range:!1,rangeSeparator:",",reversed:!1,disabledOpacity:.5},s.classes={container:"position-relative my-2",handle:"bg-body-tertiary border rounded focus-ring position-absolute translate-middle z-2",hide:"visually-hidden",slider:"progress position-relative",sliderBar:"progress-bar position-absolute",tick:"progress rounded-circle position-absolute translate-middle",tickFilled:"progress-bar z-1",tickLabel:"position-absolute p-1"};const o=s.prototype;o._checkRangeValue=function(t){let e=this._startValue,s=this._endValue,o=this._handle;return t<e?(e=t,o=this._handleStart):t>s?(s=t,o=this._handleEnd):i.isSame(o,this._handleStart)?e=t:s=t,i.isSame(o,this._handle)||i.focus(o),{start:e,end:s}},o._checkTicks=function(t){let e,i=Number.MAX_VALUE;for(const s of this._options.ticks){const o=Math.abs(s-t);o<i&&(this._options.lockToTicks||o<this._options.tickSnapBounds)&&(i=o,e=s)}return e||t},o._clampValue=function(t){return t=i._clamp(t,this._options.min,this._options.max),i._toStep(t,this._options.step)},o._createTooltip=function(t,i=0){let s;s=this._options.tooltipPlacement?this._options.tooltipPlacement:"vertical"===this._options.orientation?"right":"top";const o=e.Tooltip.init(t,{appendTo:"body",trigger:"",spacing:i,placement:s});return"always"===this._options.tooltip&&o.show(),o},o._events=function(){i.addEvent(this._node,"focus.ui.slider",(t=>{i.focus(this._handle)}));const t=i.mouseDragFactory((t=>{if(t.button||i.is(this._node,":disabled"))return!1;const s=e.getPosition(t);i.focus(this._handle),this._updatePercent(s.x,s.y,{updateValue:!1}),"show"===this._options.tooltip&&this._triggerTooltip("drag"),i.triggerEvent(this._node,"slide.ui.slider")}),(t=>{const s=this._value,o=e.getPosition(t);this._updatePercent(o.x,o.y,{updateValue:!1}),s!==this._value&&i.triggerEvent(this._node,"sliding.ui.slider",{detail:this._value})}),(t=>{if("show"===this._options.tooltip&&this._triggerTooltip("drag",!1),i.is(t.currentTarget,"[data-ui-value]")){const e=i.getDataset(t.currentTarget,"uiValue");this._setValue(e)}else{const i=e.getPosition(t);this._updatePercent(i.x,i.y)}i.focus(this._handle),i.triggerEvent(this._node,"slid.ui.slider",{detail:this._value})}));i.addEvent(this._handle,"mousedown.ui.slider touchstart.ui.slider",t),i.addEvent(this._slider,"mousedown.ui.slider touchstart.ui.slider",t),i.addEventDelegate(this._container,"mousedown.ui.slider touchstart.ui.slider","[data-ui-value]",t),i.addEvent(this._handle,"keydown.ui.slider",(t=>{if(i.is(this._node,":disabled"))return;let e=this._value;const s=e;switch(t.code){case"ArrowLeft":case"ArrowDown":if(t.ctrlKey){for(const t of this._options.ticks){if(t>=s)break;e=t}e===s&&(e=this._options.min)}else e-=this._options.step;break;case"ArrowRight":case"ArrowUp":if(t.ctrlKey){for(const t of this._options.ticks.slice().reverse()){if(t<=s)break;e=t}e===s&&(e=this._options.max)}else e+=this._options.step;break;case"Home":e=this._options.min;break;case"End":e=this._options.max;break;default:return}t.preventDefault(),this._setValue(e)}))},o._eventsRange=function(){i.addEvent(this._node,"focus.ui.slider",(t=>{i.focus(this._handleStart)}));const t=i.mouseDragFactory((t=>{if(t.button||i.is(this._node,":disabled"))return!1;const s=e.getPosition(t),o=i.nearestTo([this._handleStart,this._handleEnd],s.x,s.y,{offset:!0});i.focus(o),this._updatePercentRange(s.x,s.y,{updateValue:!1}),"show"===this._options.tooltip&&this._triggerTooltip("drag"),i.triggerEvent(this._node,"slide.ui.slider")}),(t=>{const s=this._startValue,o=this._endValue,n=e.getPosition(t);this._updatePercentRange(n.x,n.y,{updateValue:!1}),s===this._startValue&&o===this._endValue||i.triggerEvent(this._node,"sliding.ui.slider",{detail:{start:this._startValue,end:this._endValue}})}),(t=>{if("show"===this._options.tooltip&&this._triggerTooltip("drag",!1),i.is(t.currentTarget,"[data-ui-value]")){const e=i.getDataset(t.currentTarget,"uiValue");this._setValue(e)}else{const i=e.getPosition(t);this._updatePercentRange(i.x,i.y)}i.focus(this._handle),i.triggerEvent(this._node,"slid.ui.slider",{detail:{start:this._startValue,end:this._endValue}})})),s=[this._handleStart,this._handleEnd];i.addEvent(s,"mousedown.ui.slider touchstart.ui.slider",t),i.addEvent(this._slider,"mousedown.ui.slider touchstart.ui.slider",t),i.addEventDelegate(this._container,"mousedown.ui.slider touchstart.ui.slider","[data-ui-value]",t),i.addEvent(s,"focus.ui.slider",(t=>{this._handle=t.currentTarget})),i.addEvent(s,"keydown.ui.slider",(t=>{if(i.is(this._node,":disabled"))return;let e=i.isSame(this._handleStart,t.currentTarget)?this._startValue:this._endValue;const s=e;switch(t.code){case"ArrowLeft":case"ArrowDown":if(t.ctrlKey){for(const t of this._options.ticks){if(t>=s)break;e=t}e===s&&(e=this._options.min)}else e-=this._options.step;break;case"ArrowRight":case"ArrowUp":if(t.ctrlKey){for(const t of this._options.ticks.slice().reverse()){if(t<=s)break;e=t}e===s&&(e=this._options.max)}else e+=this._options.step;break;case"Home":e=this._options.min;break;case"End":e=this._options.max;break;default:return}t.preventDefault();const{start:o,end:n}=this._checkRangeValue(e);this._setValueRange(o,n)}))},o._eventsTooltip=function(){const t={};this._triggerTooltip=i._debounce(((e,i=!0)=>{i?(Object.keys(t).length||(this._tooltip._stop(),this._tooltip.show()),t[e]=!0):(delete t[e],Object.keys(t).length||(this._tooltip._stop(),this._tooltip.hide()))})),i.addEvent(this._container,"mouseenter.ui.slider",(t=>{i.isSame(t.target,this._container)&&this._triggerTooltip("hover")})),i.addEvent(this._container,"mouseleave.ui.slider",(t=>{i.isSame(t.target,this._container)&&this._triggerTooltip("hover",!1)}));const e=this._options.range?[this._handleStart,this._handleEnd]:this._handle;i.addEvent(e,"focus.ui.slider",(t=>{this._triggerTooltip("focus")})),i.addEvent(e,"blur.ui.slider",(t=>{this._triggerTooltip("focus",!1)}))},o._getPercent=function(t){if("logarithmic"!==this._options.scale)return 100*i._inverseLerp(this._options.min,this._options.max,t);if(this._options.min===this._options.max)return 0;const e=1-this._options.min,s=Math.log(this._options.max+e),o=Math.log(this._options.min+e);return 100*(Math.log(t+e)-o)/(s-o)},o._getValue=function(t){if("logarithmic"!==this._options.scale)return i._lerp(this._options.min,this._options.max,t/100);const e=1-this._options.min,s=Math.log(this._options.min+e),o=Math.log(this._options.max+e),n=Math.exp(s+(o-s)*t/100)-e;return Math.round(n)===o?o:this._options.min+n},o._moveHandle=function(t,e){let s;this._options.reversed&&(e=100-e),s="vertical"===this._options.orientation?"top":"left",i.setStyle(t,{[s]:`${e}%`})},o._refreshDisabled=function(){const t=i.is(this._node,":disabled"),e=this._options.range?[this._handleStart,this._handleEnd]:this._handle;t?(i.setStyle(this._container,{opacity:this._options.disabledOpacity}),i.setAttribute(e,{tabindex:-1})):(i.setStyle(this._container,{opacity:""}),i.removeAttribute(e,"tabindex")),i.setAttribute(e,{"aria-disabled":t})},o._render=function(){this._container=i.create("div",{class:this.constructor.classes.container,attributes:{role:"none"}}),this._renderTicks(),this._slider=i.create("div",{class:this.constructor.classes.slider}),i.append(this._container,this._slider),"vertical"===this._options.orientation?i.setStyle(this._slider,{width:`${this._options.sliderSize}px`,height:`${this._options.verticalHeight}px`}):i.setStyle(this._slider,{width:"100%",height:`${this._options.sliderSize}px`}),this._options.range&&(this._barLow=this._renderBar(this._options.low),i.append(this._slider,this._barLow)),this._barSelection=this._renderBar(this._options.selection),i.append(this._slider,this._barSelection),this._barHigh=this._renderBar(this._options.high),i.append(this._slider,this._barHigh),this._renderRangeHighlights(),this._options.range?(this._handleStart=this._renderHandle(),i.append(this._container,this._handleStart),this._handleEnd=this._renderHandle(),i.append(this._container,this._handleEnd)):(this._handle=this._renderHandle(),i.append(this._container,this._handle)),this._options.tooltip&&(this._options.range?this._tooltip=this._createTooltip(this._barSelection,(this._options.handleSize-this._options.sliderSize)/2):this._tooltip=this._createTooltip(this._handle)),i.addClass(this._node,this.constructor.classes.hide),i.setAttribute(this._node,{tabindex:-1}),i.before(this._node,this._container)},o._renderBar=function(t){const e=i.create("div",{class:this.constructor.classes.sliderBar,style:{backgroundColor:"transparent",transition:"none"}});let s,o;return t&&i.addClass(e,t),"vertical"===this._options.orientation?(s="width",o=this._options.reversed?"bottom":"top"):(s="height",o=this._options.reversed?"right":"left"),i.setStyle(e,{[s]:"100%",[o]:"0"}),e},o._renderHandle=function(){const t=i.create("button",{class:this.constructor.classes.handle,attributes:{type:"button",role:"slider","aria-valuemin":this._options.min,"aria-valuemax":this._options.max,"aria-valuenow":"","aria-valuetext":""}});return"vertical"===this._options.orientation?i.setStyle(t,{width:`${this._options.handleSize}px`,height:this._options.handleSize*this._options.handleSizeRatio+"px",left:this._options.sliderSize/2+"px"}):i.setStyle(t,{width:this._options.handleSize*this._options.handleSizeRatio+"px",height:`${this._options.handleSize}px`,top:this._options.sliderSize/2+"px"}),t},o._renderRangeHighlights=function(){for(const t of this._options.rangeHighlights){const e=this._renderBar(t.style),s=this._getPercent(t.start),o=this._getPercent(t.end)-s;"vertical"===this._options.orientation?i.setStyle(e,{height:`${o}%`,top:`${s}`}):i.setStyle(e,{width:`${o}%`,left:`${s}%`}),i.append(this._slider,e)}},o._renderTicks=function(){this._tickContainer=i.create("div"),this._ticks=[];for(const[t,e]of this._options.ticks.entries()){const s=i.create("div"),o=i.create("div",{dataset:{uiValue:e}});let n=this._getPercent(e);if(this._options.reversed&&(n=100-n),i.setStyle(o,{width:`${this._options.tickSize}px`,height:`${this._options.tickSize}px`}),"vertical"===this._options.orientation?i.setStyle(o,{bottom:`${n}%`,left:"50%"}):i.setStyle(o,{top:"50%",left:`${n}%`}),i.append(s,o),this._options.tickLabels&&this._options.tickLabels[t]){const e=i.create("small",{text:this._options.tickLabels[t],class:this.constructor.classes.tickLabel});"vertical"===this._options.orientation?i.setStyle(e,{top:`${n}%`,left:this._options.tickSize/2+"px",transform:"translateY(-50%)"}):i.setStyle(e,{top:this._options.tickSize/2+"px",left:`${n}%`,transform:"translateX(-50%)"}),i.append(s,e)}i.append(this._tickContainer,s),this._ticks.push(o)}i.append(this._container,this._tickContainer)},o._setValue=function(t,{updateValue:e=!0}={}){t=this._clampValue(t);const s=this._getPercent(t),o=100-s;let n,a;if("vertical"===this._options.orientation?(n="height",a=this._options.reversed?"bottom":"top"):(n="width",a=this._options.reversed?"right":"left"),i.setStyle(this._barSelection,{[n]:`${s}%`}),i.setStyle(this._barHigh,{[n]:`${o}%`,[a]:`${s}%`}),t!==this._value){const e=this._options.valueText.bind(this)(t);i.setAttribute(this._handle,{"aria-valuenow":t,"aria-valuetext":e}),this._options.tooltip&&i.setDataset(this._handle,{uiTitle:e}),this._moveHandle(this._handle,s),this._value=t}this._options.tooltip&&(this._tooltip.refresh(),this._tooltip.update()),this._updateTicks(),e&&`${t}`!==i.getValue(this._node)&&(i.setValue(this._node,t),i.triggerEvent(this._node,"change.ui.slider"))},o._setValueRange=function(t,e,{updateValue:s=!0}={}){t=this._clampValue(t),e=this._clampValue(e);const o=this._getPercent(t),n=this._getPercent(e),a=n-o,r=o,h=r+a,l=100-h;let d,_;if("vertical"===this._options.orientation?(d="height",_=this._options.reversed?"bottom":"top"):(d="width",_=this._options.reversed?"right":"left"),i.setStyle(this._barLow,{[d]:`${r}%`}),i.setStyle(this._barSelection,{[d]:`${a}%`,[_]:`${r}%`}),i.setStyle(this._barHigh,{[d]:`${l}%`,[_]:`${h}%`}),t!==this._startValue){const e=this._options.valueText.bind(this)(t);i.setAttribute(this._handleStart,{"aria-valuenow":t,"aria-valuetext":e}),this._moveHandle(this._handleStart,o),this._startValue=t}if(e!==this._endValue){const t=this._options.valueText.bind(this)(e);i.setAttribute(this._handleEnd,{"aria-valuenow":e,"aria-valuetext":t}),this._moveHandle(this._handleEnd,n),this._endValue=e}if(this._options.tooltip){const s=this._options.rangeText.bind(this)(t,e);i.setDataset(this._barSelection,{uiTitle:s}),this._tooltip.refresh(),this._tooltip.update()}if(this._updateTicks(),!s)return;const u=`${t}${this._options.rangeSeparator}${e}`;u!==i.getValue(this._node)&&(i.setValue(this._node,u),i.triggerEvent(this._node,"change.ui.slider"))},o._updatePercent=function(t,e,{updateValue:s=!0}={}){let o;o="vertical"===this._options.orientation?i.percentY(this._slider,e,{offset:!0}):i.percentX(this._slider,t,{offset:!0}),this._options.reversed&&(o=100-o);let n=this._getValue(o);n=this._checkTicks(n),this._setValue(n,{updateValue:s})},o._updatePercentRange=function(t,e,{updateValue:s=!0}={}){let o;o="vertical"===this._options.orientation?i.percentY(this._slider,e,{offset:!0}):i.percentX(this._slider,t,{offset:!0}),this._options.reversed&&(o=100-o);let n=this._getValue(o);n=this._checkTicks(n);const{start:a,end:r}=this._checkRangeValue(n);this._setValueRange(a,r,{updateValue:s})},o._updateTicks=function(){let t,e;this._options.range?(t=this._startValue,e=this._endValue):(t=this._options.min,e=this._value);for(const s of this._ticks){const o=i.getDataset(s,"uiValue"),n=this._options.rangeHighlights.find((t=>o>=t.start&&o<=t.end));let a=null;i.setAttribute(s,{class:""}),i.addClass(s,this.constructor.classes.tick),o<t?a=this._options.low:o>e?a=this._options.high:(i.addClass(s,this.constructor.classes.tickFilled),a=this._options.selection),n&&(a=n.style),a&&i.addClass(s,a)}},e.initComponent("slider",s),t.Slider=s}));