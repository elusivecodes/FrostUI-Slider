!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?i(exports,require("@fr0st/ui"),require("@fr0st/query")):"function"==typeof define&&define.amd?define(["exports","@fr0st/ui","@fr0st/query"],i):i((t="undefined"!=typeof globalThis?globalThis:t||self).UI=t.UI||{},t.UI,t.fQuery)}(this,(function(t,i,e){"use strict";class s extends i.BaseComponent{constructor(t,i){super(t,i),this._render(),this._events();let s=e.getValue(this._node);s||(s=this._options.defaultValue);let o=null,n=this._options.min;if(this._options.range){const t=e._isArray(s)?s:`${s}`.split(this._options.rangeSeparator);o=n,2===t.length?(o=t[0],n=t[1]):n=""!==t[0]?t[0]:this._options.min}else s&&(n=s);this._setValue(n,o),this._refreshDisabled()}disable(){e.setAttribute(this._node,{disabled:!0}),this._refreshDisabled()}dispose(){this._tooltip&&(this._tooltip.dispose(),this._tooltip=null),e.remove(this._container),e.removeEvent(this._node,"focus.ui.slider"),e.removeClass(this._node,this.constructor.classes.hide),e.removeAttribute(this._node,"tabindex"),this._container=null,this._slider=null,this._barLow=null,this._barSelection=null,this._barHigh=null,this._handleEnd=null,this._handleStart=null,this._handleActive=null,this._tickContainer=null,this._ticks=null,super.dispose()}enable(){e.removeAttribute(this._node,"disabled"),this._refreshDisabled()}getValue(){return this._options.range?[this._startValue,this._endValue]:this._endValue}setValue(t){this._options.range&&e._isArray(t)?this._setValue(...t.reverse()):this._setValue(t)}}s.defaults={min:0,max:10,defaultValue:0,orientation:"horizontal",scale:"linear",formatter:t=>t,tickSize:30,handleSize:20,handleSizeRatio:.75,sliderSize:10,verticalHeight:200,step:.01,tooltip:"show",tooltipPlacement:null,low:null,selection:"bg-primary",high:null,ticks:[],tickLabels:[],tickSnapBounds:0,lockToTicks:!1,rangeHighlights:[],range:!1,rangeSeparator:",",reversed:!1,disabledOpacity:.5},s.classes={container:"position-relative my-2",handle:"bg-body-tertiary border rounded focus-ring position-absolute translate-middle",hide:"visually-hidden",slider:"progress position-relative",sliderBar:"progress-bar position-absolute",tick:"progress rounded-circle position-absolute translate-middle",tickFilled:"progress-bar",tickLabel:"position-absolute"};const o=s.prototype;o._checkTicks=function(t){let i,e=Number.MAX_VALUE;for(const s of this._options.ticks){const o=Math.abs(s-t);o<e&&(this._options.lockToTicks||o<this._options.tickSnapBounds)&&(e=o,i=s)}return i||t},o._createTooltip=function(t,e=0){let s;s=this._options.tooltipPlacement?this._options.tooltipPlacement:"vertical"===this._options.orientation?"right":"top";const o=i.Tooltip.init(t,{appendTo:"body",trigger:"",spacing:e,placement:s});return"always"===this._options.tooltip&&o.show(),o},o._events=function(){e.addEvent(this._container,"contextmenu.ui.colorpicker",(t=>{t.preventDefault()})),e.addEvent(this._node,"focus.ui.slider",(t=>{e.focus(this._handleEnd)})),e.addEventDelegate(this._container,"click","[data-ui-value]",(t=>{if(t.button||e.is(this._node,":disabled"))return;t.preventDefault();const i=e.getDataset(t.currentTarget,"uiValue");this._setValue(i)}));let t=!1;const s=e.mouseDragFactory((s=>{if(s.button||e.is(this._node,":disabled"))return!1;if(this._options.range){const t=i.getPosition(s);this._handleActive=e.nearestTo([this._handleStart,this._handleEnd],t.x,t.y,{offset:!0})}else this._handleActive=this._handleEnd;e.setDataset(this._slider,{uiDragging:!0}),"show"!==this._options.tooltip||t||(this._tooltip._stop(),this._tooltip.show()),e.triggerEvent(this._node,"slide.ui.slider")}),(t=>{const s=this._startValue,o=this._endValue,n=i.getPosition(t);this._updatePercent(n.x,n.y,{updateValue:!1}),s===this._startValue&&o===this._endValue||e.triggerEvent(this._node,"sliding.ui.slider",{detail:{start:this._startValue,end:this._endValue}})}),(s=>{if(e.removeDataset(this._slider,"uiDragging"),"show"!==this._options.tooltip||t||(this._tooltip._stop(),this._tooltip.hide()),e.focus(this._handleActive),e.triggerEvent(this._node,"slid.ui.slider",{detail:{start:this._startValue,end:this._endValue}}),e.is(s.currentTarget,"[data-ui-value]")){const t=e.getDataset(s.currentTarget,"uiValue");this._setValue(t)}else{const t=i.getPosition(s);this._updatePercent(t.x,t.y)}})),o=this._options.range?[this._handleStart,this._handleEnd]:this._handleEnd;e.addEvent(o,"mousedown.ui.slider touchstart.ui.slider",s),e.addEvent(this._slider,"mousedown.ui.slider touchstart.ui.slider",s),e.addEventDelegate(this._container,"mousedown.ui.slider touchstart.ui.slider","[data-ui-value]",s),e.addEvent(o,"keydown.ui.slider",(t=>{if(e.is(this._node,":disabled"))return;const i=this._options.range&&e.isSame(this._handleStart,t.currentTarget);let s=i?this._startValue:this._endValue;const o=s;switch(t.code){case"ArrowLeft":if(t.ctrlKey){for(const t of this._options.ticks){if(t>=o)break;s=t}s===o&&(s=this._options.min)}else s-=this._options.step;break;case"ArrowRight":if(t.ctrlKey){for(const t of this._options.ticks.slice().reverse()){if(t<=o)break;s=t}s===o&&(s=this._options.max)}else s+=this._options.step;break;case"Home":s=this._options.min;break;case"End":s=this._options.max;break;default:return}t.preventDefault();let n=null,a=s;i&&(n=s,a=this._endValue),this._setValue(a,n)})),"show"===this._options.tooltip&&(e.addEvent(this._container,"mouseenter.ui.slider",(i=>{e.isSame(i.target,this._container)&&(e.getDataset(this._slider,"uiDragging")||(this._tooltip._stop(),this._tooltip.show()),t=!0)})),e.addEvent(this._container,"mouseleave.ui.slider",(i=>{e.isSame(i.target,this._container)&&(e.getDataset(this._slider,"uiDragging")||(this._tooltip._stop(),this._tooltip.hide()),t=!1)})))},o._getPercent=function(t){if("logarithmic"!==this._options.scale)return 100*e._inverseLerp(this._options.min,this._options.max,t);if(this._options.min===this._options.max)return 0;const i=1-this._options.min,s=Math.log(this._options.max+i),o=Math.log(this._options.min+i);return 100*(Math.log(t+i)-o)/(s-o)},o._getValue=function(t){if("logarithmic"!==this._options.scale)return e._lerp(this._options.min,this._options.max,t/100);const i=1-this._options.min,s=Math.log(this._options.min+i),o=Math.log(this._options.max+i),n=Math.exp(s+(o-s)*t/100)-i;return Math.round(n)===o?o:this._options.min+n},o._moveHandle=function(t,i){this._options.reversed&&(i=100-i),"vertical"===this._options.orientation?e.setStyle(t,{top:100-i+"%"}):e.setStyle(t,{left:`${i}%`})},o._refreshDisabled=function(){e.is(this._node,":disabled")?e.setStyle(this._container,{opacity:this._options.disabledOpacity,pointerEvents:"none"}):e.setStyle(this._container,{opacity:"",pointerEvents:""})},o._render=function(){this._container=e.create("div",{class:this.constructor.classes.container}),this._slider=e.create("div",{class:this.constructor.classes.slider}),e.append(this._container,this._slider),"vertical"===this._options.orientation?e.setStyle(this._slider,{width:`${this._options.sliderSize}px`,height:`${this._options.verticalHeight}px`}):e.setStyle(this._slider,{width:"100%",height:`${this._options.sliderSize}px`}),this._options.range&&(this._barLow=this._renderBar(this._options.low),e.append(this._slider,this._barLow)),this._barSelection=this._renderBar(this._options.selection),e.append(this._slider,this._barSelection),this._barHigh=this._renderBar(this._options.high),e.append(this._slider,this._barHigh),this._renderTicks(),this._renderRangeHighlights(),this._handleEnd=this._renderHandle(),e.append(this._container,this._handleEnd),this._options.range&&(this._handleStart=this._renderHandle(),e.append(this._container,this._handleStart)),this._options.tooltip&&(this._options.range?this._tooltip=this._createTooltip(this._barSelection,(this._options.handleSize-this._options.sliderSize)/2):this._tooltip=this._createTooltip(this._handleEnd)),e.addClass(this._node,this.constructor.classes.hide),e.setAttribute(this._node,{tabindex:-1}),e.before(this._node,this._container)},o._renderBar=function(t){const i=e.create("div",{class:this.constructor.classes.sliderBar,style:{backgroundColor:"transparent",transition:"none"}});return t&&e.addClass(i,t),"vertical"===this._options.orientation?e.setStyle(i,{width:"100%",bottom:0}):e.setStyle(i,{height:"100%"}),i},o._renderHandle=function(){const t=e.create("button",{class:this.constructor.classes.handle,attributes:{type:"button"}});return"vertical"===this._options.orientation?e.setStyle(t,{width:`${this._options.handleSize}px`,height:this._options.handleSize*this._options.handleSizeRatio+"px",left:this._options.sliderSize/2+"px"}):e.setStyle(t,{width:this._options.handleSize*this._options.handleSizeRatio+"px",height:`${this._options.handleSize}px`,top:this._options.sliderSize/2+"px"}),t},o._renderRangeHighlights=function(){for(const t of this._options.rangeHighlights){const i=this._renderBar(t.style),s=this._getPercent(t.start),o=this._getPercent(t.end)-s;"vertical"===this._options.orientation?e.setStyle(i,{height:`${o}%`,top:`${s}`}):e.setStyle(i,{width:`${o}%`,left:`${s}%`}),e.append(this._slider,i)}},o._renderTicks=function(){this._tickContainer=e.create("div"),this._ticks=[];for(const[t,i]of this._options.ticks.entries()){const s=e.create("div"),o=e.create("div",{attributes:{title:i},dataset:{uiValue:i}});let n=this._getPercent(i);if(this._options.reversed&&(n=100-n),e.setStyle(o,{width:`${this._options.tickSize}px`,height:`${this._options.tickSize}px`}),"vertical"===this._options.orientation?e.setStyle(o,{bottom:`${n}%`,left:"50%"}):e.setStyle(o,{top:"50%",left:`${n}%`}),e.append(s,o),this._options.tickLabels&&this._options.tickLabels[t]){const t=e.create("div",{text:i,class:this.constructor.classes.tickLabel});"vertical"===this._options.orientation?e.setStyle(t,{top:`${n}%`,left:"100%",transform:"translateY(-50%)"}):e.setStyle(t,{top:"100%",left:`${n}%`,transform:"translateX(-50%)"}),e.append(s,t)}e.append(this._tickContainer,s),this._ticks.push(o)}e.append(this._container,this._tickContainer)},o._setValue=function(t,i=null,{updateValue:s=!0}={}){t=e._clamp(t,this._options.min,this._options.max),t=e._toStep(t,this._options.step);const o=this._getPercent(t);let n,a,r;if(this._options.range?(i=e._clamp(i,this._options.min,this._options.max),i=e._toStep(i,this._options.step),a=this._getPercent(i),n=o-a,r=a):(n=o,r=0),!s&&t===this._endValue&&i===this._startValue)return;this._options.reversed&&(r=100-r);const h=n+r,l=100-h;"vertical"===this._options.orientation?(e.setStyle(this._barLow,{height:`${r}%`}),e.setStyle(this._barSelection,{height:`${n}%`,bottom:`${r}%`}),e.setStyle(this._barHigh,{height:`${l}%`,bottom:`${h}%`})):(e.setStyle(this._barLow,{width:`${r}%`}),e.setStyle(this._barSelection,{width:`${n}%`,left:`${r}%`}),e.setStyle(this._barHigh,{width:`${l}%`,left:`${h}%`})),e.setAttribute(this._barHigh,{"aria-valuenow":n});const _=this._options.formatter(t),d=this._options.formatter(i);let c=_;if(c=`${d} - ${_}`,t!==this._endValue&&(e.setDataset(this._handleEnd,{uiTitle:_}),this._moveHandle(this._handleEnd,o),this._endValue=t),i!==this._startValue&&(this._options.range&&(e.setDataset(this._handleStart,{uiTitle:d}),this._moveHandle(this._handleStart,a)),this._startValue=i),e.setDataset(this._barSelection,{uiTitle:c}),this._tooltip.refresh(),this._tooltip.update(),this._updateTicks(),!s)return;const p=this._options.range?`${i}${this._options.rangeSeparator}${t}`:t;p!==e.getValue(this._node)&&(e.setValue(this._node,p),e.triggerEvent(this._node,"change.ui.slider"))},o._updatePercent=function(t,i,{updateValue:s=!0}={}){let o;o="vertical"===this._options.orientation?100-e.percentY(this._slider,i,{offset:!0}):e.percentX(this._slider,t,{offset:!0}),this._options.reversed&&(o=100-o);let n=this._getValue(o);n=this._checkTicks(n);let a=null,r=n;if(this._options.range){const t=e.isSame(this._handleActive,this._handleEnd);n<this._startValue&&t?(this._handleActive=this._handleStart,a=n,r=this._startValue):n>this._endValue&&!t?(this._handleActive=this._handleEnd,a=this._endValue):t?a=this._startValue:(a=n,r=this._endValue)}this._setValue(r,a,{updateValue:s})},o._updateTicks=function(){for(const t of this._ticks){const i=e.getDataset(t,"uiValue"),s=this._options.rangeHighlights.find((t=>i>=t.start&&i<=t.end));let o=null;e.setAttribute(t,{class:""}),e.addClass(t,this.constructor.classes.tick),null!==this._startValue&i<this._startValue?o=this._options.low:i>this._endValue?o=this._options.high:(e.addClass(t,this.constructor.classes.tickFilled),o=this._options.selection),s&&(o=s.style),o&&e.addClass(t,o)}},i.initComponent("slider",s),t.Slider=s}));