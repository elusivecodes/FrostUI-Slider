!function(t,e){"use strict";"object"==typeof module&&"object"==typeof module.exports?module.exports=e:e(t)}(window,(function(t){"use strict";if(!t)throw new Error("FrostUI-Slider requires a Window.");if(!("UI"in t))throw new Error("FrostUI-Slider requires FrostUI.");const e=t.Core,s=t.dom,i=t.UI;class n extends i.BaseComponent{constructor(t,i){super(t,i),this._render(),this._events();let n=s.getValue(this._node);n||(n=this._settings.defaultValue);let a=null,r=this._settings.min;if(this._settings.range){const t=e.isArray(n)?n:`${n}`.split(this._settings.rangeSeparator);a=r,2===t.length?(a=t[0],r=t[1]):r=""!==t[0]?t[0]:this._settings.min}else n&&(r=n);this._setValue(r,a),this._refreshDisabled()}disable(){return s.setAttribute(this._node,"disabled",!0),this._refreshDisabled(),this}dispose(){this._tooltip&&(this._tooltip.dispose(),this._tooltip=null),s.remove(this._container),s.removeEvent(this._node,"focus.ui.slider"),s.removeClass(this._node,this.constructor.classes.hide),s.removeAttribute(this._node,"tabindex"),this._container=null,this._slider=null,this._barLow=null,this._barSelection=null,this._barHigh=null,this._handleEnd=null,this._handleStart=null,this._handleActive=null,this._tickContainer=null,this._ticks=null,super.dispose()}enable(){return s.removeAttribute(this._node,"disabled"),this._refreshDisabled(),this}getValue(){return this._settings.range?[this._startValue,this._endValue]:this._endValue}setValue(t){return this._settings.range&&e.isArray(t)?this._setValue(...t.reverse()):this._setValue(t),this}}Object.assign(n.prototype,{_events(){s.addEvent(this._slider,"contextmenu.ui.colorpicker",(t=>{t.preventDefault()})),s.addEvent(this._node,"focus.ui.slider",(t=>{s.focus(this._handleEnd)})),s.addEvent(this._slider,"click.ui.slider",(t=>{t.button||(t.preventDefault(),this._updatePercent(t.pageX,t.pageY))})),s.addEventDelegate(this._container,"click","[data-ui-value]",(t=>{if(t.button)return;t.preventDefault();const e=s.getDataset(t.currentTarget,"uiValue");this._setValue(e)}));let t=!1,e=!1;const n=s.mouseDragFactory((t=>{if(t.button)return!1;if(this._settings.range){const e=i.getPosition(t);this._handleActive=s.nearestTo([this._handleStart,this._handleEnd],e.x,e.y,!0)}else this._handleActive=this._handleEnd;"show"!==this._settings.tooltip||e||(this._tooltip._stop(),this._tooltip.show()),s.triggerEvent(this._node,"slide.ui.slider")}),(e=>{const n=i.getPosition(e);this._updatePercent(n.x,n.y),t=!0,s.triggerEvent(this._node,"sliding.ui.slider")}),(i=>{if(s.is(i.currentTarget,"[data-ui-value]")){const t=s.getDataset(i.currentTarget,"uiValue");this._setValue(t)}"show"!==this._settings.tooltip||e||(this._tooltip._stop(),this._tooltip.hide()),s.focus(this._handleActive),t=!1,s.triggerEvent(this._node,"slid.ui.slider")})),a=this._settings.range?[this._handleStart,this._handleEnd]:this._handleEnd;s.addEvent(a,"mousedown.ui.slider touchstart.ui.slider",n,{passive:!0}),s.addEvent(this._slider,"mousedown.ui.slider touchstart.ui.slider",n,{passive:!0}),s.addEventDelegate(this._container,"mousedown.ui.slider touchstart.ui.slider","[data-ui-value]",n,{passive:!0}),s.addEvent(a,"keydown.ui.slider",(t=>{const e=this._settings.range&&s.isSame(this._handleStart,t.currentTarget);let i=e?this._startValue:this._endValue;const n=i;switch(t.code){case"ArrowLeft":if(t.ctrlKey){for(const t of this._settings.ticks){if(t>=n)break;i=t}i===n&&(i=this._settings.min)}else i-=this._settings.step;break;case"ArrowRight":if(t.ctrlKey){for(const t of this._settings.ticks.slice().reverse()){if(t<=n)break;i=t}i===n&&(i=this._settings.max)}else i+=this._settings.step;break;case"Home":i=this._settings.min;break;case"End":i=this._settings.max;break;default:return}t.preventDefault();let a=null,r=i;e&&(a=i,r=this._endValue),this._setValue(r,a)})),"show"===this._settings.tooltip&&(s.addEvent(this._container,"mouseenter.ui.slider",(s=>{t||(this._tooltip._stop(),this._tooltip.show()),e=!0})),s.addEvent(this._container,"mouseleave.ui.slider",(s=>{t||(this._tooltip._stop(),this._tooltip.hide()),e=!1})))}}),Object.assign(n.prototype,{_checkTicks(t){let e,s=Number.MAX_VALUE;for(const i of this._settings.ticks){const n=Math.abs(i-t);n<s&&(this._settings.lockToTicks||n<this._settings.tickSnapBounds)&&(s=n,e=i)}return e||t},_createTooltip(t,e=0){let s;s=this._settings.tooltipPlacement?this._settings.tooltipPlacement:"vertical"===this._settings.orientation?"right":"top";const n=i.Tooltip.init(t,{appendTo:"body",trigger:"",spacing:e,placement:s});return"always"===this._settings.tooltip&&n.show(),n},_getPercent(t){if("logarithmic"!==this._settings.scale)return 100*e.inverseLerp(this._settings.min,this._settings.max,t);if(this._settings.min===this._settings.max)return 0;const s=1-this._settings.min,i=Math.log(this._settings.max+s),n=Math.log(this._settings.min+s);return 100*(Math.log(t+s)-n)/(i-n)},_getValue(t){if("logarithmic"!==this._settings.scale)return e.lerp(this._settings.min,this._settings.max,t/100);const s=1-this._settings.min,i=Math.log(this._settings.min+s),n=Math.log(this._settings.max+s);let a=Math.exp(i+(n-i)*t/100)-s;return Math.round(a)===n?n:this._settings.min+a},_moveHandle(t,e){this._settings.reversed&&(e=100-e),"vertical"===this._settings.orientation?s.setStyle(t,"top",100-e+"%"):s.setStyle(t,"left",`${e}%`)},_refreshDisabled(){s.is(this._node,":disabled")?s.setStyle(this._container,{opacity:this._settings.disabledOpacity,pointerEvents:"none"}):s.setStyle(this._container,{opacity:"",pointerEvents:""})},_setValue(t,i=null){if(s.is(this._node,":disabled"))return;t=e.clamp(t,this._settings.min,this._settings.max),t=e.toStep(t,this._settings.step);const n=this._getPercent(t);let a,r,h;if(this._settings.range?(i=e.clamp(i,this._settings.min,this._settings.max),i=e.toStep(i,this._settings.step),r=this._getPercent(i),a=n-r,h=r):(a=n,h=0),t===this._endValue&&i===this._startValue)return;this._settings.reversed&&(h=100-h);const l=a+h,o=100-l;"vertical"===this._settings.orientation?(s.setStyle(this._barLow,"height",`${h}%`),s.setStyle(this._barSelection,{height:`${a}%`,bottom:`${h}%`}),s.setStyle(this._barHigh,{height:`${o}%`,bottom:`${l}%`})):(s.setStyle(this._barLow,"width",`${h}%`),s.setStyle(this._barSelection,{width:`${a}%`,left:`${h}%`}),s.setStyle(this._barHigh,{width:`${o}%`,left:`${l}%`})),s.setAttribute(this._barHigh,"aria-valuenow",a);const _=this._settings.formatter(t),d=this._settings.formatter(i);let c=_;c=`${d} - ${_}`,t!==this._endValue&&(s.setDataset(this._handleEnd,"uiTitle",_),this._moveHandle(this._handleEnd,n),this._endValue=t),i!==this._startValue&&(this._settings.range&&(s.setDataset(this._handleStart,"uiTitle",d),this._moveHandle(this._handleStart,r)),this._startValue=i),s.setDataset(this._barSelection,"uiTitle",c),this._tooltip.refresh(),this._tooltip.update(),this._updateTicks();const g=this._settings.range?`${i}${this._settings.rangeSeparator}${t}`:t;s.setValue(this._node,g),s.triggerEvent(this._node,"change.ui.slider")},_updatePercent(t,e){let i;i="vertical"===this._settings.orientation?100-s.percentY(this._slider,e,!0,!0):s.percentX(this._slider,t,!0,!0),this._settings.reversed&&(i=100-i);let n=this._getValue(i);n=this._checkTicks(n);let a=null,r=n;if(this._settings.range){const t=s.isSame(this._handleActive,this._handleEnd);n<this._startValue&&t?(this._handleActive=this._handleStart,a=n,r=this._startValue):n>this._endValue&&!t?(this._handleActive=this._handleEnd,a=this._endValue):t?a=this._startValue:(a=n,r=this._endValue)}this._setValue(r,a)},_updateTicks(){for(const t of this._ticks){const e=s.getDataset(t,"uiValue"),i=this._settings.rangeHighlights.find((t=>e>=t.start&&e<=t.end));let n=null;s.setAttribute(t,"class",""),s.addClass(t,this.constructor.classes.tick),null!==this._startValue&e<this._startValue?n=this._settings.low:e>this._endValue?n=this._settings.high:(s.addClass(t,this.constructor.classes.tickFilled),n=this._settings.selection),i&&(n=i.style),n&&s.addClass(t,n)}}}),Object.assign(n.prototype,{_render(){this._container=s.create("div",{class:this.constructor.classes.container}),this._slider=s.create("div",{class:this.constructor.classes.slider}),s.append(this._container,this._slider),"vertical"===this._settings.orientation?s.setStyle(this._slider,{width:`${this._settings.sliderSize}px`,height:`${this._settings.verticalHeight}px`}):s.setStyle(this._slider,{width:"100%",height:`${this._settings.sliderSize}px`}),this._settings.range&&(this._barLow=this._renderBar(this._settings.low),s.append(this._slider,this._barLow)),this._barSelection=this._renderBar(this._settings.selection),s.append(this._slider,this._barSelection),this._barHigh=this._renderBar(this._settings.high),s.append(this._slider,this._barHigh),this._renderTicks(),this._renderRangeHighlights(),this._handleEnd=this._renderHandle(),s.append(this._container,this._handleEnd),this._settings.range&&(this._handleStart=this._renderHandle(),s.append(this._container,this._handleStart)),this._settings.tooltip&&(this._settings.range?this._tooltip=this._createTooltip(this._barSelection,(this._settings.handleSize-this._settings.sliderSize)/2):this._tooltip=this._createTooltip(this._handleEnd)),s.addClass(this._node,this.constructor.classes.hide),s.setAttribute(this._node,"tabindex","-1"),s.before(this._node,this._container)},_renderBar(t){const e=s.create("div",{class:this.constructor.classes.sliderBar,style:{backgroundColor:"transparent",transition:"none"}});return t&&s.addClass(e,t),"vertical"===this._settings.orientation?s.setStyle(e,{width:"100%",bottom:0}):s.setStyle(e,{height:"100%"}),e},_renderHandle(){const t=s.create("button",{class:this.constructor.classes.handle,attributes:{type:"button"}});return"vertical"===this._settings.orientation?s.setStyle(t,{width:`${this._settings.handleSize}px`,height:this._settings.handleSize*this._settings.handleSizeRatio+"px",left:this._settings.sliderSize/2+"px"}):s.setStyle(t,{width:this._settings.handleSize*this._settings.handleSizeRatio+"px",height:`${this._settings.handleSize}px`,top:this._settings.sliderSize/2+"px"}),t},_renderRangeHighlights(){for(const t of this._settings.rangeHighlights){const e=this._renderBar(t.style),i=this._getPercent(t.start),n=this._getPercent(t.end)-i;"vertical"===this._settings.orientation?s.setStyle(e,{height:`${n}%`,top:`${i}`}):s.setStyle(e,{width:`${n}%`,left:`${i}%`}),s.append(this._slider,e)}},_renderTicks(){this._tickContainer=s.create("div"),this._ticks=[];for(const[t,e]of this._settings.ticks.entries()){const i=s.create("div"),n=s.create("div",{attributes:{title:e},dataset:{uiValue:e}});let a=this._getPercent(e);if(this._settings.reversed&&(a=100-a),s.setStyle(n,{width:`${this._settings.tickSize}px`,height:`${this._settings.tickSize}px`}),"vertical"===this._settings.orientation?s.setStyle(n,{bottom:`${a}%`,left:"50%"}):s.setStyle(n,{top:"50%",left:`${a}%`}),s.append(i,n),this._settings.tickLabels&&this._settings.tickLabels[t]){const t=s.create("div",{text:e,class:this.constructor.classes.tickLabel});"vertical"===this._settings.orientation?s.setStyle(t,{top:`${a}%`,left:"100%",transform:"translateY(-50%)"}):s.setStyle(t,{top:"100%",left:`${a}%`,transform:"translateX(-50%)"}),s.append(i,t)}s.append(this._tickContainer,i),this._ticks.push(n)}s.append(this._container,this._tickContainer)}}),n.defaults={min:0,max:10,defaultValue:0,orientation:"horizontal",scale:"linear",formatter:t=>t,tickSize:30,handleSize:20,handleSizeRatio:.75,sliderSize:10,verticalHeight:200,step:.01,tooltip:"show",tooltipPlacement:null,low:null,selection:"bg-primary",high:null,ticks:[],tickLabels:[],tickSnapBounds:0,lockToTicks:!1,rangeHighlights:[],range:!1,rangeSeparator:",",reversed:!1,disabledOpacity:.5},n.classes={container:"position-relative my-2",handle:"btn btn-light position-absolute translate-middle p-0",hide:"visually-hidden",slider:"progress shadow-sm position-relative",sliderBar:"progress-bar position-absolute",tick:"progress rounded-circle position-absolute translate-middle p-0",tickFilled:"progress-bar",tickLabel:"position-absolute"},i.initComponent("slider",n),i.Slider=n}));